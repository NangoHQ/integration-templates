#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

node ./scripts/flows.js
npm run generate:tests --pre_commit=true
git add ./integrations/*/tests/*.test.ts
git add ./flows.yaml

npm run generate:readmes
git add ./integrations/**/*.md
# we only want to do this for files in the integrations directory that changed
# so we don't have to recompile the entire project
changed_files=$(git diff --cached --name-only | grep "^integrations")
if [ -n "$changed_files" ]; then
  # get the name of the directory that changed
  integrations=$(echo "$changed_files" | cut -d'/' -f2 | uniq)
  for integration in $integrations; do
    npm run compile --integration=$integration
  done
fi
git add ./integrations/**/.nango

npx lint-staged --allow-empty
